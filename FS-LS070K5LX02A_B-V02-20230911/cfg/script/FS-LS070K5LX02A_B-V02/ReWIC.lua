package.path = package.path .. ";./cfg/script/FS-LS070K5LX02A_B-V02/?.lua"
local otpFLow = require("luaOtpFlowModule")


--注意进制转换
local tftInitialECode = {
    0x7210,0xB1F9,0x04CC,0x1070,0x0706,0x86B0,0x8008,0x0060,
    0x0053,0x00A5,0x4000,0x007F,0x0023,0x2B32,0x7200,0x7840,
    0x0204,0x0000,0x0000,0x0915,0x0915,0x0915,0x0010,0x0000,
    0x0000,0x0000,0x0000,0x0000,0x0000,0x007A,0x8F4F,0x4E28,
    0xAFAF,0x1030,0x1040,0x4040,0xFC48,0x11FF,0xB715,0x111F,
    0x4800,0xD300,0x0006,0x090A,0x0610,0x1720,0x292C,0x2E22,
    0x1B22,0x2D22,0x1C29,0x2C1C,0x0006,0x090A,0x0610,0x1720,
    0x292C,0x2E22,0x1B22,0x2D22,0x1C29,0x2C1C,0x0006,0x090A,
    0x0610,0x1720,0x292C,0x2E22,0x1B22,0x2D22,0x1C29,0x2C1C,
    0x0006,0x090B,0x0711,0x1922,0x2D30,0x3228,0x2227,0x2F23,
    0x1B27,0x2A1A,0x0006,0x090B,0x0711,0x1922,0x2D30,0x3228,
    0x2227,0x2F23,0x1B27,0x2A1A,0x0006,0x090B,0x0711,0x1922,
    0x2D30,0x3228,0x2227,0x2F23,0x1B27,0x2A1A,0x1010,0x1080,
    0x6E70,0x34FF,0x005F,0x000A,0x0000,0x0A00,0x0004,0x0C1C,--0x6569
    0x2C3C,0x5C7C,0xBCFC,0x7CFC,0x0080,0x0040,0x80A0,0xC0D0,
    0xE0F0,0xF8FC,0x0000,0x05AF,0xFFFF,0x0004,0x0C1C,0x2C3C,
    0x5C7C,0xBCFC,0x7CFC,0x0080,0x0040,0x80A0,0xC0D0,0xE0F0,
    0xF8FC,0x0000,0x05AF,0xFFFF,0x0004,0x0C1C,0x2C3C,0x5C7C,
    0xBCFC,0x7CFC,0x0080,0x0040,0x80A0,0xC0D0,0xE0F0,0xF8FC,
    0x0000,0x05AF,0xFFFF,0x1055,0x23FF,0xAAAA,0xAAAA,0xAA00,
    0x0000,0x0000,0x0000,0x0000,0x0023,0xAAAA,0xAAAA,0xAA00,
    0x0000,0x0000,0x0000,0x0000,0x0003,0x5C5C,0x0E06,0x0E06,
    0x5A1A,0x111A,0x1A11,0x003F,0x3C00,0xFF10,0x0020,0x4060,
    0x80A0,0xC0E0,0x1078,0xC000,0x0000,0x0000,0x7323,0x0F8C,
    0x0000,0x0000,0x0032,0x3232,0x0102,0x0100,0x0101,0x0006,
    0x4354,0x0201,0x0282,0x0000,0x0000,0x0000,0x000A,0x0000,
    0x0082,0x0020,0x0000,0x0000,0x0400,0x2053,0x5327,0x3600,
    0x1000,0xC028,0x252B,0x0309,0x0C0B,0x0A00,0x0000,0x0000,
    0x0000,0x0000,0x0000,0x0000,0x0102,0x0304,0x0528,0x252B,
    0x0309,0x0C0B,0x0A00,0x0000,0x0000,0x0000,0x0000,0x0000,
    0x0000,0x0102,0x0304,0x0528,0x2500,0x030A,0x0B0C,0x0900,
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0028,0x2500,0x030A,
    0x0B0C,0x0900,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,--0x107
    0x0000,0x0000,0x0000,0x0000,0x0010,0x0000,0x0000,0x0000,--0x0041
    0x0001,0x0000,0x0000,0x0000,0xffff,0xffff,0xffff,0xffff,--0x110~0x117
    0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,--0x0000,0x0000,--0x118-0x11F FS FLAG
};


local tempDate = os.date("*t", os.time());
local month = tonumber(tempDate.month);
local day = tonumber(tempDate.day);
local hour = tonumber(tempDate.hour);
local minute = tonumber(tempDate.min);
local dayData = string.format("%02d%02d",month,day);--(month<<8 | day);
local timeData = string.format("%02d%02d",hour,minute);--(hour<<8 | minute);

local function write02(regAddr)
    local code_addr = {0x0110,0x0111,0x0112,0x0113,0x0118,0x119,0x11A,0x11B,0x11C,0x11D,0x11E,0x11F};
    for index, value in ipairs(code_addr) do
        if (value == regAddr) then
            return true
        else
            return false
        end
    end
end

local function checkEInitCode()
	for i, regValue in ipairs(tftInitialECode) do
		local regAddr = i - 1;
        if (regAddr==0x29) then
            luaPrintLog(false,string.format("29 地址[%#X]数据[%#X]",regAddr,regValue),false,false)
        elseif (regAddr==0x114) then
            otpFlowModule.writeICReg(0,regAddr,{dayData},1);
        elseif (regAddr==0x115) then
            otpFlowModule.writeICReg(0,regAddr,{timeData},1);
        elseif (write02(regAddr) == true) then
            otpFlowModule.writeICReg(0,regAddr,{0x02},1);
        else
            otpFlowModule.writeICReg(0,regAddr,{regValue},1);
            luaPrintLog(false,string.format("地址[%#X]数据[%#X]",regAddr,regValue),false,false)
        end
	end
end


checkEInitCode()
luaPrintLog(false,"写入完成",false,false)
